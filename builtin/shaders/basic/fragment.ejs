void main(inout vec4 ambient, inout vec4 diffuse, inout vec4 specular) {
  ambient = diffuse = specular = vec4(0);
  
  vec3 nNormal = normalize(vNormal);

  if (LIGHTING_ENABLED) {
    if (LIGHT_TYPE == <%=Jax.DIRECTIONAL_LIGHT%>)
      DirectionalLight(nNormal, ambient, diffuse, specular);
    else
      if (LIGHT_TYPE == <%=Jax.POINT_LIGHT%>)
        if (LIGHT_ATTENUATION_CONSTANT == 1.0 && LIGHT_ATTENUATION_LINEAR == 0.0 && LIGHT_ATTENUATION_QUADRATIC == 0.0)
          PointLightWithoutAttenuation(vSurfacePos, nNormal, ambient, diffuse, specular);
        else
          PointLightWithAttenuation(vSurfacePos, nNormal, ambient, diffuse, specular);
    else
      if (LIGHT_TYPE == <%=Jax.SPOT_LIGHT%>)
        SpotLight(vSurfacePos, nNormal, ambient, diffuse, specular);
    else
    { // error condition, output 100% red
      gl_FragColor = vec4(1,0,0,1);
      return;
    }
  } else {
    ambient = diffuse = specular = vec4(1,1,1,1);
  }

  // is this correct??
  ambient.a = 1.0;
  
  ambient *= materialAmbient * vBaseColor;
  diffuse *= materialDiffuse * vBaseColor;
  specular *= materialSpecular * vBaseColor;
}
