void main(inout vec4 ambient, inout vec4 diffuse, inout vec4 specular) {
  vec4 _ambient = vec4(0), _diffuse = vec4(0), _specular = vec4(0);
  
  vec3 nNormal = normalize(vNormal);

  if (LIGHTING_ENABLED) {
    if (LIGHT_TYPE == <%=Jax.DIRECTIONAL_LIGHT%>)
      DirectionalLight(nNormal, _ambient, _diffuse, _specular);
    else
      if (LIGHT_TYPE == <%=Jax.POINT_LIGHT%>)
        if (LIGHT_ATTENUATION_CONSTANT == 1.0 && LIGHT_ATTENUATION_LINEAR == 0.0 && LIGHT_ATTENUATION_QUADRATIC == 0.0)
          PointLightWithoutAttenuation(vSurfacePos, nNormal, _ambient, _diffuse, _specular);
        else
          PointLightWithAttenuation(vSurfacePos, nNormal, _ambient, _diffuse, _specular);
    else
      if (LIGHT_TYPE == <%=Jax.SPOT_LIGHT%>)
        SpotLight(vSurfacePos, nNormal, _ambient, _diffuse, _specular);
    else
    { // error condition, output 100% red
      gl_FragColor = vec4(1,0,0,1);
      return;
    }
  } else {
    _ambient = vec4(1,1,1,1);
    _diffuse = _specular = vec4(0,0,0,0);
  }

  // is this correct??
  if (_ambient.a != 0.0) _ambient.a = 1.0;
  
  ambient *= _ambient;
  diffuse *= _diffuse;
  specular *= _specular;
}
